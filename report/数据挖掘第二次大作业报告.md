## 数据挖掘第二次大作业报告

组长：罗弈桢

组员：侯振宇 许若虞

### 数据分析与预处理

### 聚类分析与评估

由于数据规模较大，且其中同时存在numerical和nominal的特征，因此采用能够同时处理两类数据的划分方法K-Prototypes和基于密度的方法DBSCAN进行聚类。在评价指标上，除了算法的稳定性和时间复杂度外，选择如下两个指标衡量聚类质量：

- 紧凑度compatness，设k个中心点为$c_1,c_2,\cdots,c_k$，每个点到类簇的平均距离$d_i=\frac{1}{|C_i|}\sum_{j\in C_i}dist(x_j,c_i)$，则紧凑度为簇内平均距离的平均：$C=\frac{1}{k}\sum_{i=1}^kd_i$；
- 分离度speration，即每个簇中心的平均距离：$S=\frac{2}{k^2-k}\sum_{i=1}^k\sum_{j=i+1}^kdist(c_i,c_j)$；

#### K-Prototypes方法
该方法与K-Means类似，但在距离度量和中心点更新的策略上略有不同。对于numerical特征，采用欧几里得距离的平方$(x_{ik}-x_{jk})^2$进行衡量；对于nominal特征，使用$\delta_{ij}=\begin{cases}0,x_{ik}=x_{jk}\\1,x_{ik}\neq x_{jk}\end{cases}$进行衡量（等价于one-hot编码的欧几里得距离），当特征值为未知（如None、?等）时，$\delta_{ij}$始终为1，最终的距离是所有特征的距离之和。在中心点更新时，对于numerical特征，使用类簇内所有点的均值进行表示；对于nominal特征，则使用类簇内所有点的众数进行表示。

该算法的优势在于时间复杂度较低，为$O(tnkd)$，其中n为样本数量，k为簇数量，d为特征数量，t为迭代次数，一般t取20~50算法即收敛。从稳定性进行评估，该算法的聚类质量很大程度上依赖于初始中心点的选取，且容易受到outlier的影响。

#### DBSCAN方法

### 实验结果

|      | K-Prototypes      |                    | DBSCAN      |            |
| ---- | ----------------- | ------------------ | ----------- | ---------- |
|      | compactness       | seperation         | compactness | seperation |
| k=2  | $8.2623\pm0.2491$ | $7.2395\pm1.1423$  |             |            |
| k=3  | $7.6885\pm0.0913$ | $8.2354\pm0.1595$  |             |            |
| k=5  | $7.5448\pm0.0377$ | $8.5595\pm 0.1727$ |             |            |
| k=10 | $7.2303\pm0.0599$ | $8.7345\pm0.0600$  |             |            |
| k=20 | $7.0139\pm0.0844$ | $9.0605\pm0.1244$  |             |            |

#### 可视化与可解释性分析

以K-Prototypes算法为例，假设k=5，首先考察聚类结果与特征分布的整体关联，采用t-sne对其中的5000个样本点进行可视化的结果如下（点不同颜色代表了不同的类簇）：

![t-sne](/Users/luoyizhen/Desktop/课件/数据挖掘2/hw2/Diabetrics-Data-Cluster-Analysis/report/t-sne.png)

可以发现类簇分布不均衡（红色和橙色点较少，其余三种颜色的点均衡）；同时样本特征与聚类结果存在一定的相关性，如中间上方的样本点，蓝色的簇位于左上方，紫色的簇位于右上方，绿色的簇位于下方。

为了进一步验证类簇与病人特征之间的相关模式，从numerical和nominal的特征中分别抽取了五个。对于numerical特征，选取了类簇中心点方差最大的特征，并将类簇中；对于nominal特征，首先统计类簇i取值j的频率$p_{ij}$，接着对$p_{ij}$按列求方差再按行求均值，选取了均值最大的特征，并对$p_{ij}$进行了可视化。结果如下：

![feats](/Users/luoyizhen/Desktop/课件/数据挖掘2/hw2/Diabetrics-Data-Cluster-Analysis/report/feats.png)

可以发现各个类簇的在特征上的分布存在不同。整体结论如下：

- 类簇5（紫色）的入院时长（time_in_hospital）显著长于其他几簇；
- 类簇1（蓝色）的手术次数（number_of_procedures）多于其他几簇，而诊断次数（number_of_diagnoses）则少于其他几簇；
- 类簇2（橙色）和类簇3（红色）的额外二次诊断数（diag3）少于其他几簇；
- 各个类簇男女病人数量具有显著差异，类簇1（蓝色）以男性为主，而类簇5（紫色）则以女性为主；
- 不同类簇的年龄分布显著不同，五个类簇中数量最多的分别是[50, 60), [40, 50), [70, 80), [60, 70)和[80, 90)；
- 在胰岛素水平上，类簇1（蓝色）和类簇5（紫色）取值在Steady、Up和Down的病人显著多于其他类簇；

#### 再入院信息分析

